#!/usr/bin/env gosh
;; -*-Scheme-*-
(use gauche.parseopt)
(use taco3)

(define (usage progname)
  (print "\
Usage: " progname " [options] [file ...]
options:
    -h       Print this message
    -v       Verbose mode. Prints parsed tree, ika code,
             compiled code for each complie unit.
    -i       Force interactive mode.
    -q       Force quiet mode .
"))

(define (main args)
  (let-args (cdr args)
      ((verbose      "v|verbose"     => set-verbose)
       (interactive  "i|interactive" => set-interactive)
       (quiet        "q|quiet"       => set-quiet)
       (help         "h|help"        => (cut usage (car args)))
       . rest)
    (cond ((null? rest)
           (set-interactive)
           (taco3))
          (else
           (for-each load-taco3 rest)
           ))))

(define (set-verbose)
  (with-module taco3 (set! *verbose* #t)))

(define (set-interactive)
  (with-module taco3 (set! *interactive* #t)))

(define (set-quiet)
  (with-module taco3 (set! *verbose* #f))
  (with-module taco3 (set! *interactive* #f)))

;;EOF
